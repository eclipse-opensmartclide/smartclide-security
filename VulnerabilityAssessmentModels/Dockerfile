FROM continuumio/miniconda:latest

WORKDIR /home/vp_toolbox

COPY environment.yml ./


COPY emb_model_cnn_cpp.h5 ./
COPY emb_model_cnn_java.h5 ./
COPY emb_model_cnn_js.h5 ./
COPY emb_model_cnn_py.h5 ./

COPY tokenizer_cpp.json ./
COPY tokenizer_java.json ./
COPY tokenizer_js.json ./
COPY tokenizer_py.json ./


COPY vp_service.py ./
COPY vp_model_for_service.py ./

RUN conda env create -f environment.yml
RUN echo "source activate vp_toolbox" > ~/.bashrc
ENV PATH /opt/conda/envs/vp_toolbox/bin:$PATH

EXPOSE 5008

# The code to run when container is started:
#ENTRYPOINT ["conda", "run", "-n", "vp_toolbox", "python", "vp_service.py"]
#ENTRYPOINT ["python", "vp_service.py", "MONGO_IP", "MONGO_PORT"]

#RUN wget --no-check-certificate -O /home/vp_toolbox/download.zip "https://drive.google.com/drive/folders/15P5UBg5OQSIUhSemxtr5Pl16gVd50wpw"

# Install unzip
#RUN apk add --no-cache unzip -y

# Unzip the downloaded file
#RUN unzip /home/vp_toolbox/download.zip -d /home/vp_toolbox

# Remove the zip file
#RUN rm /app/download.zip


#RUN wget --no-check-certificate -O /home/vp_toolbox/emb_model_cnn_cpp.h5 "https://drive.google.com/file/d/13TKy8ETOfOSHY4o6PxotX_ZrTh9U-Hip/view?usp=share_link"
#RUN wget --no-check-certificate -O /home/vp_toolbox/emb_model_cnn_java.h5 "https://drive.google.com/file/d/1QfY3rQipttgpn3lQxJazMpgUGAcgjujO/view?usp=share_link"
#RUN wget --no-check-certificate -O /home/vp_toolbox/emb_model_cnn_js.h5 "https://drive.google.com/file/d/1SzKv0PKO_Q_3ouo6xFptJ5xIDAh1meow/view?usp=share_link"
#RUN wget --no-check-certificate -O /home/vp_toolbox/emb_model_cnn_py.h5 "https://drive.google.com/file/d/1xWgGDOt0soP7lAGNu-mSpNakTNViK_yX/view?usp=share_link"

#COPY tokenizer_cpp.json ./
#COPY tokenizer_java.json ./
#COPY tokenizer_js.json ./
#COPY tokenizer_py.json ./
#RUN wget --no-check-certificate -O /home/vp_toolbox/tokenizer_cpp.json "https://drive.google.com/file/d/1DtUs2Mwg38MuT0jr5RGdmoeREUg4OWHU/view?usp=share_link"
#RUN wget --no-check-certificate -O /home/vp_toolbox/tokenizer_java.json "https://drive.google.com/file/d/1D1zO-3eDgIUK1qLwfNJf4MbKZeZ-bO5X/view?usp=share_link"
#RUN wget --no-check-certificate -O /home/vp_toolbox/tokenizer_js.json "https://drive.google.com/file/d/1qBAPr6-3TAek9BXuBkFRagqz1ntcoe7O/view?usp=share_link"
#RUN wget --no-check-certificate -O /home/vp_toolbox/tokenizer_py.json "https://drive.google.com/file/d/1733qvgWtflaAAAW9FiJ4E64jyrtmDbGj/view?usp=share_link"

#RUN conda install -c conda-forge unzip

# Unzip the downloaded file
#RUN unzip /home/vp_toolbox/download.zip -d /home/vp_toolbox

# Remove the zip file
#RUN rm /home/vp_toolbox/download.zip



